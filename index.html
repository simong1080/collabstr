<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nostr Collaborative Docs</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@18.2.0",
      "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
      "lucide-react": "https://esm.sh/lucide-react@0.263.1"
    }
  }
  </script>

  <script type="module">
    import React, { useState, useEffect } from 'react';
    import ReactDOM from 'react-dom/client';
    import { Key, LogIn, Wifi, WifiOff, Plus, Trash2, X, Edit, Send, Users, FileText, Clock, Check, AlertCircle } from 'lucide-react';

    // Use React.createElement instead of JSX
    const h = React.createElement;

    const App = () => {
      const [currentUser, setCurrentUser] = useState(null);
      const [hasNip07, setHasNip07] = useState(false);

      useEffect(() => {
        setHasNip07(!!window.nostr);
      }, []);

      if (!currentUser) {
        return h('div', { 
          className: 'min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-6' 
        },
          h('div', { className: 'max-w-md w-full bg-white/10 backdrop-blur-lg rounded-lg p-8 border border-white/20' },
            h(FileText, { className: 'w-16 h-16 text-purple-400 mx-auto mb-4' }),
            h('h1', { className: 'text-4xl font-bold text-white text-center mb-2' }, 'Nostr Docs'),
            h('p', { className: 'text-purple-200 text-center mb-6' }, 'Sign in to collaborate'),
            h('div', { className: 'space-y-3' },
              hasNip07 && h('button', {
                onClick: async () => {
                  try {
                    const pubkey = await window.nostr.getPublicKey();
                    setCurrentUser({ publicKey: pubkey, name: 'User', authMethod: 'nip07' });
                  } catch (err) {
                    alert('Failed to sign in: ' + err.message);
                  }
                },
                className: 'w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-4 rounded-lg font-semibold flex items-center justify-center gap-3'
              },
                h(Key, { className: 'w-5 h-5' }),
                'Sign in with NIP-07'
              ),
              h('button', {
                onClick: () => {
                  const demo = { publicKey: '1234...', name: 'Demo User', authMethod: 'demo' };
                  setCurrentUser(demo);
                },
                className: 'w-full bg-white/20 hover:bg-white/30 text-white px-6 py-4 rounded-lg font-semibold'
              }, 'Try Demo Mode')
            )
          )
        );
      }

      // Signed in view
      return h('div', { 
        className: 'min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6' 
      },
        h('div', { className: 'max-w-4xl mx-auto' },
          h('div', { className: 'bg-white/10 backdrop-blur-lg rounded-lg p-6 border border-white/20' },
            h('h1', { className: 'text-3xl font-bold text-white mb-2' }, 'Nostr Collaborative Documents'),
            h('p', { className: 'text-purple-200' }, `Signed in as: ${currentUser.name}`),
            h('button', {
              onClick: () => setCurrentUser(null),
              className: 'mt-4 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg'
            }, 'Sign Out')
          )
        )
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(h(App));
  </script>
</body>
</html>
